var url="http://102.130.122.187/smartbill/php";
$("document").ready(function(){document.addEventListener("deviceready",function(){document.addEventListener("backbutton",function(){window.location.href="home.html"},!1);$(document).on("click","#print-token",function(d){d.preventDefault();console.log("Print button defined in lec.js; line 111 [R 120], listener from line 11 to line 16")})},!1);$(document).on("click","#print-token",function(d){d.preventDefault();console.log("Print button defined in lec.js; line 111, listener from line 11 to line 16")});$("#lec-form").validate({rules:{password:{required:!0},
user_email:{required:!0,email:!0}},messages:{password:{required:"please enter your password"},user_email:"please enter your email address"}});$("#logout").click(function(){window.location.href="index.html"});var e=localStorage.getItem("Phone");" "==e&&(window.location.href="index.html");$("#agent").append(" "+e);$("#btn-lec").click(function(d){d.preventDefault();var b=$("#lec-form").serializeArray();b.push({name:"phone",value:e});b.push({name:"vendor",value:"lec"});b.push({name:"purpose",value:"vend"});
b.push({name:"confirmed",value:"false"});$.ajax({type:"POST",url:url+"/gettoken.php",data:b,beforeSend:function(){$("#result").fadeOut();$("#btn-lec").html('<span class="glyphicon glyphicon-lec"></span> &nbsp; Processing, wait...')},timeout:0,success:function(f){var a=JSON.parse(f);console.log(a);"ok"==a.Code||"OK"==a.Code?"ConfirmationRequired"==a.Confirmation&&(b.length=0,$("#btn-lec").html('<img src="btn-ajax-loader.gif" /> &nbsp; Please, wait...'),$("#result").fadeIn(100,function(){$("#meternumber").hide();
$("#usernumber").hide();$("#amount").hide();$("#btn-lec").hide();$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; <strong>Confirm meter details.</strong><br/> <strong>Meter#:</strong> '+a.Meternumber+"<br/><strong>Owner:</strong> "+a.Owner+"<br/><strong>Location:</strong> "+a.Location+"<br/><strong>User Phone:</strong> "+a.Userphone+"<br/><strong>Min Vend Amount:</strong> M"+numeral(a.MinVend).format("0,0.00")+"<br/><strong>Max Vend Amount:</strong> M"+
numeral(a.MaxVend).format("0,0.00"));$("#btn-confirm").css("visibility","visible");$("#btn-cancel").css("visibility","visible");$("#tlec-form").hide();$("#rlec-form").hide();$("#buttons").html('<button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-confirm" id="btn-confirm"><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Confirm Details</strong></button><hr><button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-cancel" id="btn-cancel" ><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Cancel</strong></button>')}),
$("#btn-confirm").click(function(g){g.preventDefault();console.log("Meter number confirmed");b.push({name:"confirmed",value:"true"});b.push({name:"phone",value:a.Agentphone});b.push({name:"vendor",value:a.Vendor});b.push({name:"meternumber",value:a.Meternumber});b.push({name:"usernumber",value:a.Userphone});b.push({name:"amount",value:a.Amount});b.push({name:"referenceid",value:a.ReferenceId});b.push({name:"owner",value:a.Owner});b.push({name:"datetime",value:a.Datetime});$.ajax({type:"POST",url:url+
"/gettoken.php",data:b,beforeSend:function(){$("#result").fadeOut();$("#result").html("");$("#btn-cancel").hide();$("#btn-confirm").html('<span class="glyphicon glyphicon-lec"></span> &nbsp; Processing, wait...')},success:function(a){var c=JSON.parse(a);"OK"==c.Code?($("#btn-confirm").html('<img src="btn-ajax-loader.gif" /> &nbsp; Purchasing electricity, wait...'),$("#result").fadeIn(100,function(){$("#result").html('<div class="alert alert-danger"><center><h5>*** TAX INVOICE ***</h5></center><pre>'+
c.Token+"</pre></div>");$("#btn-confirm").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Done').after('<button style="visibility: visible;" type="button" class="btn btn-default" name="btn-confirm" id="print-token"><span class="glyphicon glyphicon-print"></span> &nbsp; Print</button>')}),$("#btn-confirm").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})):"Done"==c.Code?($("#result").html(""),b.length=0,$("#result").fadeIn(100,function(){$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; '+
c.Response+" </div>");setTimeout(' window.location.href = "lec.html"; ',500)})):"Failed"==c.Code&&(b.length=0,$("#result").fadeIn(100,function(){$("#meternumber").hide();$("#usernumber").hide();$("#amount").hide();$("#btn-lec").hide();$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; <br/>'+c.Response+"<strong><br/><br/>LEC Helpline: +2665210 0000.</strong></div>");$("#btn-confirm").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Cancel');
$("#btn-confirm").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})}))},timeout:0,error:function(a){$("#result").fadeIn(100,function(){$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Network error! '+a+".</div>");$("#btn-lec").html('<span class="glyphicon glyphicon-log-in"></span> &nbsp; Try Again')})}})})):"Failed"==a.Code&&(b.length=0,$("#result").fadeIn(100,function(){$("#btn-cancel").css("visibility",
"visible");$("#meternumber").hide();$("#usernumber").hide();$("#amount").hide();$("#btn-lec").hide();$("#tlec-form").hide();$("#rlec-form").hide();$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span>&nbsp;<strong>ERROR OCCURRED</strong><br/> '+a.Response+".<br/><strong>LEC Helpline: +2665210 0000.</strong></div>");$("#btn-cancel").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})}))},error:function(b){console.log(b);
$("#result").fadeIn(100,function(){$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Network error! '+b+".</div>");$("#btn-lec").html('<span class="glyphicon glyphicon-log-in"></span> &nbsp; Try Again')})}})});$("#tbtn-lec").click(function(d){d.preventDefault();var b=$("#tlec-form").serializeArray();b.push({name:"phone",value:e});b.push({name:"vendor",value:"lec"});b.push({name:"purpose",value:"tokenlist"});b.push({name:"confirmed",value:"false"});
b.push({name:"amount",value:"0"});b.push({name:"usernumber",value:"0"});$.ajax({type:"POST",url:url+"/gettoken.php",data:b,beforeSend:function(){$("#tresult").fadeOut();$("#tbtn-lec").html('<span class="glyphicon glyphicon-lec"></span> &nbsp; Processing, wait...')},success:function(d){var a=JSON.parse(d);"ok"==a.Code||"OK"==a.Code?"ConfirmationRequired"==a.Confirmation&&(b.length=0,$("#tbtn-lec").html('<img src="btn-ajax-loader.gif" /> &nbsp; Please, wait...'),$("#tresult").fadeIn(100,function(){$("#tmeternumber").hide();
$("#tbtn-lec").hide();$("#tresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Confirm meter details.<br/> <strong>Meter#:</strong> '+a.Meternumber+"<br/><strong>Owner:</strong> "+a.Owner+"<br/><strong>Location:</strong> "+a.Location+"<br/><strong>User Phone:</strong> "+a.Userphone+"<br/><strong>Min Vend Amount:</strong> "+numeral(a.MinVend).format("0,0.00"));$("#tbtn-confirm").css("visibility","visible");$("#tbtn-cancel").css("visibility","visible");
$("#lec-form").hide();$("#rlec-form").hide();$("#buttons").html('<button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-confirm" id="btn-confirm"><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Confirm Details</strong></button><hr><button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-cancel" id="btn-cancel" ><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Cancel</strong></button>')}),$("#tbtn-cancel").click(function(a){a.preventDefault();
setTimeout(' window.location.href = "lec.html"; ',10)}),$("#tbtn-confirm").click(function(d){d.preventDefault();b.push({name:"confirmed",value:"true"});b.push({name:"phone",value:a.Agentphone});b.push({name:"purpose",value:"tokenlist"});b.push({name:"vendor",value:a.Vendor});b.push({name:"tmeternumber",value:a.Meternumber});b.push({name:"usernumber",value:a.Userphone});b.push({name:"amount",value:a.Amount});b.push({name:"referenceid",value:a.ReferenceId});b.push({name:"owner",value:a.Owner});$.ajax({type:"POST",
url:url+"/gettoken.php",data:b,beforeSend:function(){$("#tresult").fadeOut();$("#tresult").html("");$("#tbtn-cancel").hide();$("#tbtn-confirm").html('<span class="glyphicon glyphicon-lec"></span> &nbsp; Processing, wait...')},success:function(a){var c=JSON.parse(a);"OK"==c.Code?($("#tbtn-confirm").html('<img src="btn-ajax-loader.gif" /> &nbsp; Purchasing electricity, wait...'),$("#tresult").fadeIn(100,function(){$("#tresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; <strong>Token list:</strong> <br/>'+
c.Receipt1+"&nbsp; M"+c.Tender1+"<br/>"+c.Receipt2+"&nbsp; M "+c.Tender2+"<br/>"+c.Receipt3+"&nbsp; M"+c.Tender3+"</div>");$("#tbtn-confirm").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Done')}),$("#tbtn-confirm").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})):"Done"==c.Code?($("#tresult").html(""),b.length=0,$("#tresult").fadeIn(100,function(){$("#tresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; '+
c.Response+" </div>");setTimeout(' window.location.href = "lec.html"; ',500)})):"Failed"==c.Code&&(b.length=0,$("#tresult").fadeIn(100,function(){$("#tmeternumber").hide();$("#tusernumber").hide();$("#tamount").hide();$("#tbtn-lec").hide();$("#tresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; <br/>'+c.Response+".<strong><br/><br/>LEC Helpline: +2665210 0000.</strong></div>");$("#tbtn-confirm").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Cancel');
$("#tbtn-confirm").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})}))},error:function(a){$("#tresult").fadeIn(100,function(){$("#tresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Network error! Call Venus Dawn for support.</div>');$("#tbtn-lec").html('<span class="glyphicon glyphicon-log-in"></span> &nbsp; Try Again')})}});d.preventDefault()})):"Failed"==a.Code&&(b.length=0,$("#result").fadeIn(100,
function(){$("#btn-cancel").css("visibility","visible");$("#meternumber").hide();$("#usernumber").hide();$("#amount").hide();$("#btn-lec").hide();$("#tlec-form").hide();$("#rlec-form").hide();$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span><br/> &nbsp; <br/>'+a.Response+".<strong><br/><br/>LEC Phone: +2665210 0000.</strong></div>");$("#btn-cancel").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})}))},
error:function(b){$("#result").fadeIn(100,function(){$("#result").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Network error! Call Venus Dawn for support.</div>');$("#btn-lec").html('<span class="glyphicon glyphicon-log-in"></span> &nbsp; Try Again')})}})});$("#rbtn-lec").click(function(d){d.preventDefault();var b=$("#rlec-form").serializeArray();b.push({name:"phone",value:e});b.push({name:"vendor",value:"lec"});b.push({name:"purpose",value:"tokenreprint"});
b.push({name:"confirmed",value:"false"});b.push({name:"amount",value:"0"});$.ajax({type:"POST",url:url+"/gettoken.php",data:b,beforeSend:function(){$("#rresult").fadeOut();$("#rbtn-lec").html('<span class="glyphicon glyphicon-lec"></span> &nbsp; Processing, wait...')},success:function(d){var a=JSON.parse(d);"ok"==a.Code||"OK"==a.Code?(b.length=0,$("#rbtn-lec").html('<img src="btn-ajax-loader.gif" /> &nbsp; Please, wait...'),$("#rresult").fadeIn(100,function(){$("#lec-form").hide();$("#tlec-form").hide();
$("#rmeternumber").hide();$("#rusernumber").hide();$("#receiptnumber").hide();$("#rresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; <br/><strong>Receipt (Reprint):</strong><br/>Rf#: '+a.Receipt+"<br/>Vendor: "+a.AgentName+"<br/>Vendor Phone: "+a.AgentPhone+"<br/><strong>Owner details</strong><br/>Name: "+a.Owner+"<br/>Meter: "+a.Meternumber+"<br/><strong>Transaction details</strong><br/>Amount: M"+numeral(a.Amount).format("0,0.00")+"<br/>Debt: M"+
numeral(a.Debt).format("0,0.00")+"<br/>Units: "+a.Units+" KW/h<br/>FBE Units: "+a.FBEUnits+" KW/h<br/>Token: "+a.Token+"<br/>VAT Number: 50007525<br/>LEC Phone: +26652100000 </div>");$("#buttons").html('<button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-confirm" id="btn-confirm"><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Confirm Details</strong></button><hr><button style="visibility:hidden;" type="submit" class="btn btn-default" name="btn-cancel" id="btn-cancel" ><span class="glyphicon glyphicon-arrow-right"></span> &nbsp; <strong>Cancel</strong></button>')}),
$("#rbtn-lec").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Done'),$("#rbtn-lec").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})):"Failed"==a.Code&&(b.length=0,$("#rresult").fadeIn(100,function(){$("#rbtn-lec").html('<span class="glyphicon glyphicon-arrow-right"></span> &nbsp; Cancel');$("#rmeternumber").hide();$("#rusernumber").hide();$("#receiptnumber").hide();$("#amount").hide();$("#btn-lec").hide();$("#tlec-form").hide();$("#lec-form").hide();
$("#rresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span><br/> '+a.Response+".<strong><br/><br/>LEC Phone: +2665210 0000.</strong></div>");$("#rbtn-lec").click(function(a){a.preventDefault();setTimeout(' window.location.href = "lec.html"; ',10)})}))},error:function(b){$("#rresult").fadeIn(100,function(){$("#rresult").html('<div class="alert alert-danger"> <span class="glyphicon glyphicon-info-sign"></span> &nbsp; Network error! Call Venus Dawn for support.</div>');
$("#rbtn-lec").html('<span class="glyphicon glyphicon-log-in"></span> &nbsp; Sign In')})}})})});